<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Image Generation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a2e;
            color: white;
        }
        button {
            background: #00d4ff;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            margin: 10px;
        }
        #result {
            margin-top: 20px;
            padding: 20px;
            background: rgba(0, 212, 255, 0.1);
            border: 2px solid #00d4ff;
            border-radius: 10px;
        }
        img {
            max-width: 100%;
            margin-top: 20px;
            border-radius: 10px;
        }
        .loading {
            color: #00d4ff;
        }
    </style>
</head>
<body>
    <h1>üé® Gemini Nano Banana Image Generator Test</h1>

    <button onclick="checkModels()">Check Available Models</button>
    <button onclick="testDrElena()">Generate Dr. Elena Portrait</button>
    <button onclick="testLabScene()">Generate Lab Crisis Scene</button>
    <button onclick="testCellSignaling()">Generate Cell Signaling Diagram</button>

    <div id="result"></div>

    <script>
        const API_KEY = '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';
        const API_URL = 'https://openrouter.ai/api/v1/chat/completions';
        // Try the correct model name for Nano Banana
        const MODEL = 'google/gemini-2.5-flash-image';

        async function generateImage(prompt, name) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `<div class="loading">üé® Generating ${name}... Please wait...</div>`;

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json',
                        'HTTP-Referer': 'https://cellcollective.org',
                        'X-Title': 'Cell Collective Modeling Game'
                    },
                    body: JSON.stringify({
                        model: MODEL,
                        messages: [
                            {
                                role: 'user',
                                content: prompt
                            }
                        ]
                    })
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                const data = await response.json();
                console.log('API Response:', data);

                // Display the full response to understand the format
                resultDiv.innerHTML = `
                    <h3>‚úÖ Image Generated!</h3>
                    <pre style="background: #000; padding: 15px; border-radius: 5px; overflow-x: auto;">
                        ${JSON.stringify(data, null, 2)}
                    </pre>
                `;

                // Try to extract and display the image if available
                if (data.choices && data.choices[0]) {
                    const content = data.choices[0].message.content;
                    resultDiv.innerHTML += `
                        <h4>Content:</h4>
                        <div style="background: #000; padding: 15px; border-radius: 5px;">
                            ${content}
                        </div>
                    `;
                }

            } catch (error) {
                resultDiv.innerHTML = `
                    <div style="color: #ff4444;">
                        ‚ùå Error: ${error.message}
                    </div>
                `;
                console.error('Error:', error);
            }
        }

        function testDrElena() {
            const prompt = `Professional portrait of Dr. Elena Rodriguez, a friendly Hispanic female scientist in her 30s, wearing a white lab coat, with warm brown eyes and dark hair in a ponytail, standing in a modern molecular biology laboratory with microscopes and screens in the background, photorealistic style, bright professional lighting, welcoming smile`;
            generateImage(prompt, 'Dr. Elena Portrait');
        }

        function testLabScene() {
            const prompt = `Wide shot of a modern molecular biology research laboratory in slight disarray, computer screens showing unexpected data patterns in blue and green, petri dishes and lab equipment on benches, dramatic lighting suggesting urgency but not chaos, photorealistic, cinematic composition`;
            generateImage(prompt, 'Lab Crisis Scene');
        }

        function testCellSignaling() {
            const prompt = `Scientific illustration of cellular signaling pathway, showing a receptor protein on cell membrane receiving a signal molecule, activating enzyme inside the cell, clean modern medical illustration style, blue and cyan color scheme matching Cell Collective branding, educational diagram quality`;
            generateImage(prompt, 'Cell Signaling Diagram');
        }

        async function checkModels() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `<div class="loading">üîç Checking available models...</div>`;

            try {
                // Test with a simple text model first
                const response = await fetch('https://openrouter.ai/api/v1/models', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`
                    }
                });

                const data = await response.json();
                console.log('Models:', data);

                // Filter for image models
                const imageModels = data.data ? data.data.filter(m => m.id.includes('image') || m.id.includes('2.5')) : [];

                resultDiv.innerHTML = `
                    <h3>Available Image Models:</h3>
                    <pre style="background: #000; padding: 15px; border-radius: 5px; overflow-x: auto;">
                        ${JSON.stringify(imageModels.map(m => m.id), null, 2)}
                    </pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div style="color: #ff4444;">‚ùå Error: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
